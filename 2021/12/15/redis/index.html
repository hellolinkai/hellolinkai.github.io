<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Redis, Link blog">
    <meta name="description" content="Nosql概述什麽是nosql
nosql=not only  sql(不仅仅是sql)
泛指非关系型数据库，随着web2.0互联网的诞生，

大数据时代的3v

海量 volume
多样 verlety
实时 velocity

大数据时">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Redis | Link blog</title>
    <link rel="icon" type="image/png" href="/medias/logo_link.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo_link.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Link blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo_link.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Link blog</div>
        <div class="logo-desc">
            
            林凯的博客
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hellolinkai" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hellolinkai" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/11.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Redis</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/redis/">
                                <span class="chip bg-color">redis</span>
                            </a>
                        
                            <a href="/tags/nosql/">
                                <span class="chip bg-color">nosql</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/NoSql/" class="post-category">
                                NoSql
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-12-15
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="Nosql"><a href="#Nosql" class="headerlink" title="Nosql"></a>Nosql</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>什麽是nosql</p>
<p>nosql=not only  sql(不仅仅是sql)</p>
<p>泛指非关系型数据库，随着web2.0互联网的诞生，</p>
<blockquote>
<p>大数据时代的3v</p>
</blockquote>
<p>海量 volume</p>
<p>多样 verlety</p>
<p>实时 velocity</p>
<blockquote>
<p>大数据时代的3高</p>
</blockquote>
<p>高并发</p>
<p>高可扩</p>
<p>高性能</p>
<h3 id="redis-memcache-mongdb对比"><a href="#redis-memcache-mongdb对比" class="headerlink" title="redis/memcache/mongdb对比"></a>redis/memcache/mongdb对比</h3><blockquote>
<p>redis</p>
</blockquote>
<ol>
<li><p>支持比较弱的事务，只能保证事务中的每个操作连续执行</p>
</li>
<li><p>不仅支持简单的k/v类型，还提供list,set,hash等  数据结构的存储</p>
</li>
<li><p>支持数据的备份，即master-slave模式的数据备份</p>
</li>
<li><p>支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。</p>
</li>
<li><p>单线程</p>
</li>
</ol>
<blockquote>
<p>memcache</p>
</blockquote>
<ol>
<li>不支持事务，通过cas（check and set，通俗来说就是版本号）保持一致性</li>
<li>数据结构单一</li>
<li>不支持持久化，通常只做缓存，用来 提升性能</li>
<li>多线程（非阻塞IO复用的网络模型）</li>
</ol>
<p>数据结构单一</p>
<blockquote>
<p>mongdb</p>
</blockquote>
<ol>
<li>不支持事务</li>
<li>支持丰富的数据表达，最类似关系型数据库，有非常丰富的查询语言。</li>
<li>采用binlog方式支持持久化的可靠性</li>
</ol>
<blockquote>
<p>根据应用场景（数据量）的比较</p>
</blockquote>
<p>redis &lt; memcache &lt; mongdb</p>
<h3 id="四大分类"><a href="#四大分类" class="headerlink" title="四大分类"></a>四大分类</h3><p><strong>KV键值对</strong></p>
<p><strong>文档行数据库</strong>（存的是bson格式  和json一样）</p>
<p>​    MongoDB</p>
<ul>
<li><p>​    MongoDB是一个基于分布式文件存储的数据库，c++编写的，主要用来处理大量的文档。</p>
</li>
<li><p>​    MongoDB是一个介于关系型数据库和非关系型数据库中间的产品，是非关系型数据库中功能最丰富的，最像关系型数据库的。</p>
</li>
</ul>
<p><strong>列存储数据库</strong></p>
<ul>
<li>HBase</li>
<li>分布式文件系统</li>
</ul>
<p><strong>图关系数据库</strong></p>
<h2 id="redis入门"><a href="#redis入门" class="headerlink" title="redis入门"></a>redis入门</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><blockquote>
<p>redis是什么？</p>
</blockquote>
<p><em>Redis</em>（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p>
<p>免费和开源，亦可称为结构化数据库。</p>
<p>单进程</p>
<blockquote>
<p>Redis 能干什么？</p>
</blockquote>
<ol>
<li>内存存储，持久化，内存中是断电即失，所以持久化很重要（rdb,aof） </li>
<li>效率高，可以用于高速缓存</li>
<li>发布订阅系统</li>
<li>地图信息分析</li>
<li>计时器，计数器（浏览量）</li>
<li>……</li>
</ol>
<blockquote>
<p>特性</p>
</blockquote>
<ol>
<li>多样的数据类型</li>
<li>持久化</li>
<li>集群</li>
<li>事务</li>
<li>……</li>
</ol>
<p>官网：<a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a></p>
<p>中文网：<a target="_blank" rel="noopener" href="http://www.redis.cn/">http://www.redis.cn</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ol>
<li><p>下载安装包</p>
</li>
<li><p>解压redis安装包</p>
</li>
<li><p>基本安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 基础软件安装</span></span><br><span class="line">yum install gcc-c++</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入redis解压包执行make安装</span></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="meta">#</span><span class="bash"> redis默认安装路径/usr/<span class="built_in">local</span>/bin  安装完成会在bin目录生成以下6个文件</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\link\Learning\Redis\images\redis1.2.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在bin目录下新建一个conf文件夹，用来存放我们自己的conf文件。然后把redis解压包中的redis.conf拷贝过来。</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">redis默认的不是后台启动，需要修改配置文件,修改daemonize为yes</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\link\Learning\Redis\images\redis1.0.png"></p>
</li>
<li><p>启动redis服务</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@root bin]# redis-server conf/redis.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试是否启动成功</span></span><br><span class="line">[root@root bin]# redis-cli -p 6379		#利用redis客户端进行连接</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt; set name link</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;link&quot;</span><br><span class="line">127.0.0.1:6379&gt; keys *			#查看下所有键</span><br><span class="line">1) &quot;name&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检测redis进程是否启动</span></span><br><span class="line">[root@root bin]# ps -ef|grep redis     # ps -ef查看所有进程，通过管道符grep过滤出redis的进程</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭redis服务</span></span><br><span class="line">127.0.0.1:6379&gt; shutdown 		 #关闭redis</span><br><span class="line">not connected&gt; exit</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; mset k1 v1 k2 v2	#同时设置多个值</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2			#同时获取多个值</span><br><span class="line">127.0.0.1:6379&gt; msetnx k1 v1 k2 v2	#msetnx是一个原子性的操作，要么一起成功，要么一起失败。</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; getset key hello	#如果不存在值，则返回nil, 如果存在值，获取原来的值，并设置新的值。</span><br></pre></td></tr></table></figure>





<blockquote>
<p>安装时可能出现的问题</p>
</blockquote>
<ol>
<li><font color="red">server.c:5307:31: 错误:‘struct redisServer’没有名为‘server_xxx’的成员</font></li>
</ol>
<p>redis编译报上面错误，一般是环境问题，执行下面操作可以解决</p>
<p>1、安装gcc套装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install cpp</span><br><span class="line">yum install binutils</span><br><span class="line">yum install glibc</span><br><span class="line">yum install glibc-kernheaders</span><br><span class="line">yum install glibc-common</span><br><span class="line">yum install glibc-devel</span><br><span class="line">yum install gcc</span><br><span class="line">yum install make</span><br></pre></td></tr></table></figure>

<p>2、升级gcc</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install centos-release-scl</span><br><span class="line"></span><br><span class="line">yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils</span><br><span class="line"></span><br><span class="line">scl enable devtoolset-9 bash</span><br></pre></td></tr></table></figure>

<p>3、设置永久升级：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;source /opt/rh/devtoolset-9/enable&quot; &gt;&gt;/etc/profile</span><br></pre></td></tr></table></figure>

<p>4、从新编译安装redis：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make clean		# 先清除上一步的编译内容， 再重新编译</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>



<h3 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h3><p>redis-benchmark是一个官方自带压力测试工具</p>
<p><img src="D:\link\Learning\Redis\images\redis2.0.png"></p>
<p>简单测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark -h localhost -p 6379 -c 100 -n 100000			#10万请求 100并发</span><br></pre></td></tr></table></figure>

<p><img src="D:\link\Learning\Redis\images\redis2.1.png"></p>
<h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> redis默认有16个数据库，默认使用的是第0个。</span></span><br><span class="line">127.0.0.1:6379&gt; select 3	# 切换到第3个数据库</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; dbsize		# 数据大小</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; flushdb		#清除当前库</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; flushall	#清除全部数据库</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; exists key		# 检查某个键是否存在</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; expire key 10	# 设置key 10秒过期</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl key			# 查看还剩多少秒过期</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; move key 1		# 把key移动到1库中</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; type key		# 查看当前key的类型</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; append key &quot;hello&quot;		# 往key中追加字符串hello， 如果追加的key不存在，则执行set新增。</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; strlen key		# 获取key的长度</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; incr key 		# 自增，值自动+1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; incrby key 10 	# 自增10，设置步长，指定增量</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; decr key		# 自减，值自动-1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; decrby key 5	# 自减5，设置步长，指定减量</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; getrange key 0 5 # 获取字符串范围，从下标0取到下标5</span><br><span class="line">127.0.0.1:6379&gt; getrange key 0 -1 # 取全部</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; setrange key 1 xx  # 替换指定位置开始的字符串</span><br><span class="line">例： key = &#x27;abcdefg&#x27; 执行setrange key 1 xx 后key值变为&#x27;axxdefg&#x27;，它会把下标1开始的两位替换成xx</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; setex key 10 &quot;hello&quot;	# 设置key的值为hello，并指定过期时间为10秒</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; setnx key &quot;hello&quot;				# 不存在再设置（分布式锁中常用） key不存在则设置，存在则不设置。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; save		# 保存cinfig配置操作</span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>Redis 是单线程的。</strong></p>
</blockquote>
<p>redis基于内存操作，redis的瓶颈是机器的内存和网络带宽。</p>
<p>redis是c语言写的，官方数据100000+的QPS</p>
<p>cpu速度 &gt; 内存 &gt; 硬盘速度。</p>
<p>redis是将数据全部放在内存中的，所以说使用单线程去操作效率最高。（多线程，cpu需要上下文切换的）</p>
<h3 id="5种数据类型"><a href="#5种数据类型" class="headerlink" title="5种数据类型"></a>5种数据类型</h3><h4 id="String-字符串"><a href="#String-字符串" class="headerlink" title="String(字符串)"></a>String(字符串)</h4><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>基本的数据类型，列表，  可以用list实现栈，队列，阻塞队列。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush key v1		# 往左边插入</span><br><span class="line">127.0.0.1:6379&gt; lpush key v2</span><br><span class="line">127.0.0.1:6379&gt; lpush key v3</span><br><span class="line">127.0.0.1:6379&gt; lpush key v4</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; lrange key 0 -1		# 获取所有值</span><br><span class="line">127.0.0.1:6379&gt; lrange key 0 1		# 获取索引0到1的值</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; rpush key right		# 往右边插入</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; lpop key			# 移除列表第一个元素（也就是左边第一个）</span><br><span class="line">127.0.0.1:6379&gt; rpop key			# 移除列表最后一个元素（也就是右边第一个）</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; lindex key 1		# 通过下标获取list中的某个值</span><br><span class="line">127.0.0.1:6379&gt; llen key			# 获取list长度	</span><br><span class="line">127.0.0.1:6379&gt; lrem key n v1		# 移除n个指定（v1）值</span><br><span class="line">127.0.0.1:6379&gt; ltrim key 1 2		# 通过下标截取list, 截取后list被改变，变成剩下的元素</span><br><span class="line">127.0.0.1:6379&gt; rpoplpush key key2 	# 移除key列表的最后一个元素，将它移动到新的key2列表中</span><br><span class="line">127.0.0.1:6379&gt; lset key 0 item		# 将key列表中指定下标(0)的值替换为另外一个值(item)，更新操作,如果下标不存在则报错。</span><br><span class="line">127.0.0.1:6379&gt; linsert key BEFORE|AFTER pivot element # 往key列表中pivot的前面或后面插入 element</span><br><span class="line">例</span><br><span class="line">127.0.0.1:6379&gt; linsert key BEFORE a hello		# 往key列表的a前面加入hello</span><br></pre></td></tr></table></figure>

<p>消息队列（lpush    rpop）, 栈（lpush   lpop）</p>
<h4 id="set-集合"><a href="#set-集合" class="headerlink" title="set(集合)"></a>set(集合)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sadd key &quot;hello&quot;		# set集合中添加元素</span><br><span class="line">smembers key			# 查看指定set的所有值</span><br><span class="line">sismember key hello		# 判断某个值是不是在set集合中</span><br><span class="line"></span><br><span class="line">scard key 				# 获取set集合中内容元素个数</span><br><span class="line">srem key hello			# 移除set集合中的hello</span><br><span class="line">srandmember key			# 随机出一个元素</span><br><span class="line">srandmember key	n		# 随机出n个元素</span><br><span class="line"></span><br><span class="line">spop key				# 随机移除一个元素</span><br><span class="line">smove key key2 v1		# 将集合中一个元素移动到另一个set集合中</span><br><span class="line">sdiff key key2			# 差值</span><br><span class="line">sinter key key2			# 交集</span><br><span class="line">sunion key key2			# 并集</span><br></pre></td></tr></table></figure>

<p>微博， A用户所有关注的人放在一个set集合中，所有粉丝放在一个集合中。</p>
<p>可以实现共同关注，共同爱好，二度好友，推荐好友</p>
<h4 id="hash-哈希"><a href="#hash-哈希" class="headerlink" title="hash(哈希)"></a>hash(哈希)</h4><p>Map集合， key-map 更适合对象的存储。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset key filed v1		# 设置map 字段名 值</span><br><span class="line">127.0.0.1:6379&gt; hget key filed			# 取值</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; hmset key filed1 v1 filed2 v2	# 存多值</span><br><span class="line">127.0.0.1:6379&gt; hmget key filed1 filed2		# 取多值</span><br><span class="line">127.0.0.1:6379&gt; hgetall key			# 获取全部数据</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; hdel key filed1		# 删除某字段</span><br><span class="line">127.0.0.1:6379&gt; hlen key			# 获取hash表的字段数量</span><br><span class="line">127.0.0.1:6379&gt; hexists key filed1	# 判断hash中指定字段是否存在</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; hkeys key		# 获取所有字段</span><br><span class="line">127.0.0.1:6379&gt; hvals key		# 获取所有值</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; hincrby key filed1 n	# 递增n</span><br><span class="line">127.0.0.1:6379&gt; hdecrby key filed1 n	# 递减n</span><br><span class="line">127.0.0.1:6379&gt; hsetnx key filed2 woorld   # 如果不存在则设置，存在则不再设置</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="zset（有序集合）"><a href="#zset（有序集合）" class="headerlink" title="zset（有序集合）"></a>zset（有序集合）</h4><p>在set基础上增加一个值， set k1 v1      zset k1  score1 v1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd key 1 one		# 增加一个值one</span><br><span class="line">127.0.0.1:6379&gt; zadd key 2 two 3 three	# 增加多个值</span><br><span class="line">127.0.0.1:6379&gt; zrange key 0 -1		# 取值</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore key -inf 1300 withscores    # 显示小于1300的信息，升序</span><br><span class="line">127.0.0.1:6379&gt; zrem key val1 [val2]	# 移除</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; zcard user		# 获取有序集合的个数</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; zrevrange user 0 -1		# 从大到小排序</span><br><span class="line">127.0.0.1:6379&gt; zcount user 0 1			# 获取区间中的成员数量</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>存储成绩表，工资表</p>
<h3 id="三种特殊类型"><a href="#三种特殊类型" class="headerlink" title="三种特殊类型"></a>三种特殊类型</h3><h4 id="geospatial-地理位置"><a href="#geospatial-地理位置" class="headerlink" title="geospatial 地理位置"></a>geospatial 地理位置</h4><p>朋友的定位，附近的人， 打车距离，两地之间距离，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">geoadd china:city 116.40 39.90 beijing	# key 维度 经度 名称</span><br><span class="line">geoadd china:city 116.40 39.90 beijing 121.47 31.23 shanghai # 可以一次添加多个，中间用空格隔开</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; geopos china:city beijing shenzhen # 获取经纬度，多个之间用空格隔开</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; geodist china:city beijing shanghai #获取两地距离，默认单位米</span><br><span class="line">127.0.0.1:6379&gt; geodist china:city beijing shanghai km # 返回千米</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 单位</span></span><br><span class="line">m	米</span><br><span class="line">km	千米</span><br><span class="line">mi	英里</span><br><span class="line">ft	英尺</span><br></pre></td></tr></table></figure>

<p>我附件的人</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius china:city 110 30 1000 km  # 查找坐标110 30 1000千米内的， 110 30是经纬度。1000是半径</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; geopos china:city beijing shenzhen  # 返回指定元素的位置（经纬度）</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; geohash china:city beijing	# 返回一个或多个位置元素的 Geohash 表示</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; georadiusbymember china:city beijing 1000 km	# 找到指定元素的周围元素，与georadius相同，只不过这里是根据元素去查询，而不是经纬坐标。</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; zrem china:city beijing		# 移除</span><br><span class="line">127.0.0.1:6379&gt; zrange china:city 0 -1		# 查询所有元素</span><br></pre></td></tr></table></figure>

<blockquote>
<p>geo 底层的实现原理其实就是zset，我们可以使用zset命令来操作geo.</p>
</blockquote>
<h4 id="hyperloglog"><a href="#hyperloglog" class="headerlink" title="hyperloglog"></a>hyperloglog</h4><blockquote>
<p>什么是基数?</p>
</blockquote>
<p>不重复的元素</p>
<blockquote>
<p>简介</p>
</blockquote>
<p>hyperloglog用来做基数统计的算法</p>
<p><strong>网页UV (一个人访问一个网站多次，但是还算作一个人)</strong></p>
<p>有0.81%的错误率， 只需12k</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; pfadd key a b c d	# 创建一组元素</span><br><span class="line">127.0.0.1:6379&gt; pfcount k	# 统计元素的基数数量</span><br><span class="line">127.0.0.1:6379&gt; pfadd key2 e b c f</span><br><span class="line">127.0.0.1:6379&gt; pfmerge key3 key key2 # 合并再组，并集。</span><br><span class="line">127.0.0.1:6379&gt; pfcount key3	# 并集数量</span><br></pre></td></tr></table></figure>



<h4 id="bitmaps（位图）"><a href="#bitmaps（位图）" class="headerlink" title="bitmaps（位图）"></a>bitmaps（位图）</h4><blockquote>
<p>位存储</p>
</blockquote>
<p>统计用户信息：活跃/不活跃,  登录/位登录 , 打卡, 两个状态的都可用使用bitmaps,  存储 0  1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 例一周的打卡，</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 0 1		# 添加</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 1 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 2 1</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 3 1</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 4 1</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 5 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 6 0</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; getbit sign 3	# 查看周四打没打卡</span><br><span class="line">127.0.0.1:6379&gt; bitcount sign	# 统计打卡多少天</span><br></pre></td></tr></table></figure>



<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>redis事务本质：一组命令的集合,一个事务中的所有命令都会被序列化，在事务执行过程中，会按照顺序执行。 一次性，顺序性，排他性，执行一些列的命令。</p>
<p><font color="red">redis事务没有隔离级别的概念</font></p>
<p><font color="red">redis单条命令是保证原子性的，但是事务不保证原子性。</font></p>
<p>redis事务：</p>
<ul>
<li><p>​    开启事务（multi）</p>
</li>
<li><p>​    命令入队（…）</p>
</li>
<li><p>​    执行事务（exec）</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi	# 开启事务</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2</span><br><span class="line">127.0.0.1:6379&gt; discard		# 取消事务</span><br><span class="line">127.0.0.1:6379&gt; exec	# 执行事务</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译型异常（代码/命令错误），事务中所有的命令都不会被执行</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; getset k3</span><br><span class="line">(error) ERR wrong number of arguments for &#x27;getset&#x27; command</span><br><span class="line">127.0.0.1:6379&gt; set k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>运行是异常(1/0),如果事务队列中存在语法性，那么执行命令的时候，其它命令是可以正常执行的，错误命令抛出异常。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1	# 设置个字符串</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incr k1		# 执行元素加1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec		# 执行事务</span><br><span class="line">1) OK		# 第一条执行成功   第二条由于字符串没法加1所以异常。</span><br><span class="line">2) (error) ERR value is not an integer or out of range</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;v1&quot;		# 获取元素，发现k1设置成功。但是没有加1，因为加1异常了。</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="乐观-悲观锁"><a href="#乐观-悲观锁" class="headerlink" title="乐观/悲观锁"></a>乐观/悲观锁</h3><h4 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h4><p>很悲观，认为什么时候都会出问题，无论做什么都会加锁</p>
<h4 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h4><p>很乐观，认为什么 时候都不会出问题，所以不会上，更新的时候去判断一下在此期间是否有人更改过这个数据。</p>
<p>获取version</p>
<p>更新的时候比较version</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; watch key		#监听key对象, 是用watch可以当做乐观锁</span><br><span class="line"><span class="meta">#</span><span class="bash"> 事务正常结束，数据期间没有发生变动，这个时候就正常执行成功</span></span><br><span class="line">127.0.0.1:6379&gt; multi			# 开启事务</span><br><span class="line">127.0.0.1:6379&gt; decrby	key 10</span><br><span class="line">127.0.0.1:6379&gt; incrby	key2 10</span><br><span class="line">127.0.0.1:6379&gt; exec			# 执行事务</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; unwatch			# 如果事务执行失败，需要先解锁， 在watch监听加锁。</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="缓存穿透（查不到）"><a href="#缓存穿透（查不到）" class="headerlink" title="缓存穿透（查不到）"></a>缓存穿透（查不到）</h3><blockquote>
<p>概念</p>
</blockquote>
<p>用户想要查询一个数据，发现redis内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询，发现也没有，于是本次查询失败。当用户很多的时候（也就是访问量跟并发起来时），由于缓存都没有命中，于是都去请求持久化数据库，这时就会给持久化数据库造成很大的压力，这就是缓存穿透。</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<ol>
<li><p>缓存没命中时给它存个空对象</p>
<p>弊端：存了很多空键</p>
</li>
<li><p>布隆过滤器</p>
<p>布隆过滤器是一种数据 结构，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则丢弃，从而避免对底层存储系统的查询压力。</p>
</li>
</ol>
<h3 id="缓存击穿（量大，缓存过期）"><a href="#缓存击穿（量大，缓存过期）" class="headerlink" title="缓存击穿（量大，缓存过期）"></a>缓存击穿（量大，缓存过期）</h3><blockquote>
<p>概述</p>
</blockquote>
<p>缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点访问，当这个key在失效（过期）的瞬间，持续的大并发就穿破的缓存，直接请求数据库，就像一个在一个屏障上凿开了一个洞。这时高并发的去读取数据，写入缓存，对持久化数据库造成压力。</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<ol>
<li>设置热点永不过期</li>
<li>加互斥锁</li>
</ol>
<h3 id="雪崩"><a href="#雪崩" class="headerlink" title="雪崩"></a>雪崩</h3><p>指在某一个时间段，缓存集中过期失效，如redis宕机。</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<ol>
<li>redis高可用，搭建集群</li>
<li>限流降级（加锁或队列来控制读数据库写缓存的线程数量）</li>
<li>数据预热</li>
<li>不同类型的缓存key设置不同过期时间，分散过期时间点。</li>
</ol>
<h3 id="命中率"><a href="#命中率" class="headerlink" title="命中率"></a>命中率</h3><p>命中：可以直接通过缓存获取到需要的数据。</p>
<p>不命中：无法直接通过缓存获取到想要的数据，需要再次查询数据库或者执行其它的操作。原因可能是由于缓存中根本不存在，或者缓存已经过期。</p>
<p>通常来讲，缓存的命中率越高则表示使用缓存的收益越高，应用的性能越好（响应时间越短、吞吐量越高），抗并发的能力越强。</p>
<p>由此可见，在高并发的互联网系统中，缓存的命中率是至关重要的指标。</p>
<blockquote>
<p>如何监控缓存的命中率？</p>
</blockquote>
<p>通过redis的info命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# /usr/local/bin/redis-cli info		#通过info命令查询</span><br><span class="line"><span class="meta">#</span><span class="bash"> Server</span></span><br><span class="line">redis_version:6.0.6</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"> Stats</span></span><br><span class="line">...</span><br><span class="line">evicted_keys:0</span><br><span class="line">keyspace_hits:31		# 总命中次数</span><br><span class="line">keyspace_misses:1		# 总的未命中次数</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"> 命中率 = keyspace_hits/(keyspace_hits+keyspace_misses)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如何提高命中率</p>
</blockquote>
<p>缓存粒度（缓存粒度越小，命中率越高）</p>
<p>缓存预加载（缓存预热就是在系统上线后，提前将相关的缓存数据直接加载到缓存系统，避免在用户请求的时候，先查数据库，然后在将数据缓存的问题，让用户直接查询事先预热的缓存数据。解法方案：直接写个缓存刷新页面手动操作，定时刷新缓存，数据量不大时可以启动项目时自动加载）</p>
<p>增加存储容量（避免空间导致缓存过期）</p>
<p>更新缓存</p>
<h3 id="conf-配置文件"><a href="#conf-配置文件" class="headerlink" title="conf 配置文件"></a>conf 配置文件</h3><ol>
<li>配置文件unit单位对大小写不敏感。</li>
</ol>
<blockquote>
<p>网络</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1		# 绑定ip</span><br><span class="line">protected-mode yes	# 保护模式</span><br><span class="line">port 6379			# 端口</span><br><span class="line"></span><br><span class="line">daemonize yes		# 以守护进程的方式运行，默认是no, 一般我们需要设置为yes改为后台运行。</span><br><span class="line">pidfile /var/run/redis_6379.pid		# 如果以后台运行，需要指定一个pid文件</span><br><span class="line">loglevel notice		# 日志</span><br><span class="line">logfile &quot;&quot;		# 日志文件位置</span><br><span class="line">databases 16	# 数据库数量，默认16个</span><br><span class="line">always-show-logo yes	# 是否总是显示log</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 快照</span></span><br><span class="line">save 900 1	# 如果900秒内，如果至少有1个key进行了修改，进行持久化操作</span><br><span class="line">save 300 10	# 如果300秒内，如果至少有10个key进行了修改，进行持久化</span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error yes	# 持久化如果出错，是否还需要继续工作</span><br><span class="line">rdbcompression yes	# 是否压缩rdb文件，需要消耗一些cup资源。</span><br><span class="line">rdbchecksum yes	# 保存red文件时，进行错误校验</span><br><span class="line">dir ./	# rdb保存的目录</span><br></pre></td></tr></table></figure>

<blockquote>
<p>REPLICATION复制</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicaof &lt;masterip&gt; &lt;masterport&gt;	#replicaof 主机ip  端口</span><br></pre></td></tr></table></figure>



<blockquote>
<p>SECURITY安全</p>
</blockquote>
<p>requirepass    设置redis密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config set requirepass &quot;123456&quot;		# 设置redis密码</span><br><span class="line">127.0.0.1:6379&gt; config get requirepass	# 查看密码</span><br><span class="line">127.0.0.1:6379&gt; auth 123456		# 使用密码进行登录</span><br></pre></td></tr></table></figure>

<blockquote>
<p>限制CLIENT</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">maxclients	10000	# 设置能连接上redis的最大客户端的数量</span><br><span class="line">maxmemory &lt;bytes&gt;	# redis配置最大的内存容量</span><br><span class="line">maxmemory-policy noeviction	# 内存达到最大上限的策略</span><br><span class="line">	volatile-lru	： 只对设置了过期时间的key进行lru(默认值)</span><br><span class="line">	allkeys-lru		:  删除lru算法的key</span><br><span class="line">	volatile-random	： 随机删除即将过期key</span><br><span class="line">	allkeys-random	： 随机删除</span><br><span class="line">	volatile-ttl	： 删除即将过期的</span><br><span class="line">	noeviction	 	:  永不过期，返回错误</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<blockquote>
<p>APPEND ONLY模式aof配置</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">appendonly no		# 默认是不开启aof模式的，默认是使用rdb方式持久化的，在大部分所有的情况下，rdb完全够用。</span><br><span class="line">appendfilename	&quot;&quot;	# 持久化文件名 .aof/.rdb文件</span><br><span class="line">appendsync everysec	# 每秒执行一次sync，可能会丢失这1s的数据</span><br><span class="line">	always	:  每次修改部分sync,消耗性能</span><br><span class="line">	no		:  不执行sync,这时操作系统自己同步，速度最快</span><br></pre></td></tr></table></figure>



<h3 id="redis-持久化"><a href="#redis-持久化" class="headerlink" title="redis 持久化"></a>redis 持久化</h3><h4 id="rdb"><a href="#rdb" class="headerlink" title="rdb"></a>rdb</h4><p>是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。</p>
<p><img src="D:\link\Learning\Redis\images\redis3.0.png"></p>
<p>rdb保存的文件dump.rdb</p>
<blockquote>
<p>触发机制</p>
</blockquote>
<ol>
<li>save的规则满足的情况下，会自动触发rdb规则</li>
<li>执行flushall命令，也会触发rdb规则</li>
<li>退出redis,也会产生rdb文件</li>
</ol>
<p>备份就自动生成一个dump.rdb</p>
<blockquote>
<p>恢复rdb文件</p>
</blockquote>
<ol>
<li><p>只需将rdb文件放在我们redis启动目录即可，redis启动时会自动检查dump.rdb恢复其中的数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config get dir</span><br><span class="line">1) &quot;dir&quot;</span><br><span class="line">2) &quot;/usr/local/bin&quot;	# 把dump.rdb文件放到此路径下，启动就会自动恢复其中数据</span><br></pre></td></tr></table></figure></li>
</ol>
<p>优点：</p>
<ol>
<li>适合大规模的数据恢复</li>
<li>对数据的 完整性要不高</li>
</ol>
<p>缺点：</p>
<ol>
<li><p>需要一定的时间间隔进程操作，如果redis意外宕机，这最后一次修改数据就 没有了。</p>
</li>
<li><p>fork进程的时候，会占用一定的内存空间。</p>
</li>
</ol>
<h4 id="aof"><a href="#aof" class="headerlink" title="aof"></a>aof</h4><p>append only file</p>
<p>以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录。</p>
<p><img src="D:\link\Learning\Redis\images\redis3.1.png"></p>
<p>修改配置文件</p>
<p>appendonly  no  # 默认不开启的,改为yes开启</p>
<p>改了配置文件需要重启。</p>
<p>如果aof文件有误，redis是启动不起来的，需要修复aof文件。redis为我们提供了 一个工具redis-check-aof –fix</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@root bin]# redis-check-aof --fix appendonly.aof</span><br></pre></td></tr></table></figure>

<blockquote>
<p>优点和缺点</p>
</blockquote>
<ol>
<li>每一次修改都同步，文件的完整性会更好</li>
<li>默认每秒同步一次（appendfsync   everysec），可能会丢失一秒的数据。</li>
<li>从不同步(appendfsync  no)，效率最高。</li>
</ol>
<p>缺点</p>
<ol>
<li>相对于数据文件来说，aof远远大于rdb,修复速度比rdb慢</li>
<li>aof运行效率也要比rdb慢，所以我们redis默认配置是rdb持久化</li>
</ol>
<h4 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h4><ol>
<li><p>rdb 持久化方式能够在指定的时间间隔内对你的数据进行快照存储。</p>
</li>
<li><p>aof 持久化方式记录每次对服务器的写操作，当服务器重启时会重新执行这些命令来恢复原始的数据，aof命令以redis协议追加保存每次写的操作到文件末尾，redis还能对aof文件进行后台重写，使得aof文件的体积不至于过大。</p>
</li>
<li><p>只做缓存，如果你只希望你的数据在服务器运行时存在，可不使用持久化</p>
</li>
<li><p>同时开启两种持久化方式</p>
<ul>
<li><p>当redis重启的时候会优先载入aof文件来恢复原始数据，因为通常情况下aof文件保存的数据 要比rdb文件保存的数据集完整。</p>
</li>
<li><p>rdb的数据不实时，同时使用两者时服务器重启也会找aof文件，那要不要只是用aof呢，作者建议不要，认为rdb更适合用于备份数据库（aof在不断变化不好备份），快速重启，而且不会有aof可能潜在的bug，可以留着作为一个万一的手段。</p>
</li>
</ul>
</li>
<li><p>性能建议</p>
<ul>
<li>以为rdb文件只用作后备用途，建议只在slave上持久化rdb文件，而且只要15分钟备份一次就够了，只保留save 900 1这条规则</li>
<li>如果enable aof，好处是在最恶劣情况下也只会丢失不超过2秒钟数据。启动脚本比较简单，只load自己的aof文件即可，代价一是带来  持续的IO,二是aof wewrite的频率，aof重写的基础大小默认值64M太小了，可以设置到哦5G以上，默认超过原大小100%大小重写可以改到适当的数据。</li>
<li>如果不enable aof,仅靠master-slave repllcation实现高可用性也可以，能省掉一大笔IO,也减少了rewrite时带来的系统波动，代价是如果Master/Slave同时倒掉，会丢失十几分钟的数据，启动脚本也要比较两个Master/Slave中的rdb文件，载入较新的那个，微博就是这种架构。</li>
</ul>
</li>
</ol>
<h3 id="发布订阅"><a href="#发布订阅" class="headerlink" title="发布订阅"></a>发布订阅</h3><p>redis发布订阅（pub/sub）是一种<font color="red">消息通信模式</font>:发送者（pub）发送消息，订阅者（sub）接收消息。 微信  微博  关注系统</p>
<p>redis 客户端可以订阅任何数量的频道。</p>
<p>订阅/发布消息图：</p>
<p><img src="D:\link\Learning\Redis\images\redis-pub.png"></p>
<blockquote>
<p>命令</p>
</blockquote>
<p>psubscribe pattem …          #  订阅一个或多个给定模式的频道</p>
<p>pubsub subcommand [argument ….]            # 查看订阅与发布系统状态</p>
<p>publish channel message                # 将消息推送到指定频道</p>
<p>punsubscribe [pattem pattem2 …]      # 退订所有给定模式的频道</p>
<p>subscribe [channel channel2 …]    # 订阅给定的一个或多个频道</p>
<p>unsubscribe [channel channel2 …]    # 退订指定的频道</p>
<blockquote>
<p>测试</p>
</blockquote>
<p>订阅端</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; subscribe hellolink			# 订阅一个频道hellolink</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;hellolink&quot;</span><br><span class="line">3) (integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 等待读取推送的消息， 当</span></span><br><span class="line">1) &quot;message&quot;		# 消息</span><br><span class="line">2) &quot;hellolink&quot;		# 频道</span><br><span class="line">3) &quot;hello eveyone&quot;	# 消息内容</span><br></pre></td></tr></table></figure>

<p>发送端</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; publish hellolink &quot;hello eveyone&quot;	# 推送者发布消息到频道hellolink</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>应用场景</p>
</blockquote>
<ol>
<li>实时消息系统</li>
<li>实时聊天</li>
<li>订阅，关注系统</li>
</ol>
<p>稍微复杂的场景我们就会使用消息中间件MQ</p>
<h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>主从复制，是将一台redis服务器的数据，复制到其他的redis服务器，前者称之为主节点（master/leader）,后者称为从节点（slave/follower）；数据的复制是单向的，只能从主节点到从节点。master已写为主，slave以读为主。</p>
<p>默认情况下，每台redis服务器都是主节点，且一个主节点可以有多个从节点（或没有从节点），但一个从节点只能有一个主节点。</p>
<blockquote>
<p>主从复制的作用</p>
</blockquote>
<ol>
<li>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据荣有方式</li>
<li>故障恢复：当主节点出现问题时，可以有从节点提供服务，实现快速的故障恢复，实际上是一种服务的冗余。</li>
<li>负载均衡：在主从复制的基础上，配合都写分离，可以有 主节点提供写服务，从节点提供读服务（即写redis数据时应用连接主节点，读redis数据时应用连接从节点），分担服务器负载，尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高redsi服务器的并发量。</li>
<li>高可用（集群）基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是redis高可用的基础。</li>
</ol>
<p>一般来说，要将redis运用于工程项目中，只用一台redis是万万不能的（最基本的就是一主2从），原因如下：</p>
<ol>
<li><p>从结构上，单个redis服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大。</p>
</li>
<li><p>从容器上，单个redis服务器内存有限，就算一台redis服务器内存容量为256G，也不能将所有内存用作redis存储内存，一般来说，单台redis最大使用内存不应该超过20G.</p>
<p>电商网站上的商品，一般都是一次上传，无数次浏览的，说专业点就是“多读少写”</p>
</li>
</ol>
<h4 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication	# 查看当前库的信息</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:master			# 角色 master</span><br><span class="line">connected_slaves:0	# 没有从机</span><br><span class="line">master_replid:e6c6e796a861300a60d403bba29fb0d18943ad67</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure>



<h4 id="一主二从"><a href="#一主二从" class="headerlink" title="一主二从"></a>一主二从</h4><blockquote>
<p>通过命令配置</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; slaveof 127.0.0.1 6379	# 找谁作主机</span><br><span class="line">127.0.0.1:6381&gt; slaveof 127.0.0.1 6379	# 找谁作主机</span><br></pre></td></tr></table></figure>

<p>如果是通过命令来配置的主从，如果从机重启了，就会变回主机。此外只要再变回从机，数据会立马从主机中同步。</p>
<blockquote>
<p>从配置文件中配置</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicaof &lt;masterip&gt; &lt;masterport&gt;	#replicaof 主机ip  端口</span><br></pre></td></tr></table></figure>



<blockquote>
<p>复制原理</p>
</blockquote>
<p>slave启动成功连接到master后会发送一个sync同步命令</p>
<p>Master接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕后，master将传送整个数据文件到slave,并完成一次完全  同步。</p>
<p>全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</p>
<p>增量复制：master继续将新的所有收集到的修改命令依次传给slave,完成同步。</p>
<p>只要是重新连接master，一次完全同步（全量复制）将被自动执行。</p>
<blockquote>
<p>从机改为主机</p>
</blockquote>
<p>如果主机断开了连接，我们可以使用slaveof no one命令来把自己设置为主机。</p>
<h4 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h4><p>(自动选举老大的模式)</p>
<blockquote>
<p>概述</p>
</blockquote>
<p>当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费时费力，还会造成一段时间内服务不可用，这不是推荐的方式。所以更多时候，我们优先考虑哨兵模式（从redis2.8开始提供了）。</p>
<p>哨兵模式能够后台监控主机是否故障，如果故障了，根据投票数自动将 从库转换为主库。</p>
<p>哨兵是一个独立的进程，作为进程，它会独立运行，其原理是<strong>哨兵通过发送命令，等待redis服务器的响应，从而监控允许的多个redis实例。</strong></p>
<p><img src="D:\link\Learning\Redis\images\redis-shaobing.png"></p>
<p>一个哨兵进程对redis服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控，各个哨兵之间还会进行监控，这样就形成了多哨兵模式。</p>
<p><img src="D:\link\Learning\Redis\images\redis-shaobingm.png"></p>
<p>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象成为<strong>主观下线</strong>。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起 ，进行failover(故障转移)操作，切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器切换为主机，这个过程称为<strong>客观下线</strong>。</p>
<blockquote>
<p>配置</p>
</blockquote>
<ol>
<li><p>配置哨兵配置文件sentinel.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sentinel monitor 被监控的名称 host port 1</span></span><br><span class="line">sentinel monitor myredis 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure>

<p>后面的这个数字1,代表主机挂了，slave投票让谁接替成为主机，票数最多的就会成为主机。</p>
</li>
<li><p>启动哨兵</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@root bin]# redis-sentinel /conf/sentinel.conf</span><br></pre></td></tr></table></figure>

<p>如果master节点断开了，这时候会从从机中随机选出一个 作为主机（根据算法）</p>
<p>如果主机回来后，只能归并到新的主机下当个从机。</p>
</li>
</ol>
<blockquote>
<p>优点</p>
</blockquote>
<ol>
<li>哨兵 集群，基于主从复制模式，所有的主从配置优点，它都有。</li>
<li>主从可以切换，故障可以转移，系统的可用就会更好。</li>
<li>哨兵模式就是主从模式的升级，手动到自动，更加健壮。</li>
</ol>
<blockquote>
<p>缺点</p>
</blockquote>
<ol>
<li>redis不好在线扩容的，集群容量一旦达到上限，在线扩容就十分麻烦。</li>
</ol>
<blockquote>
<p>哨兵模式的全部配置</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 哨兵sentinel实例运行的端口 默认26379</span></span><br><span class="line">port 26379</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 哨兵的sentinel工作目录</span></span><br><span class="line">dir /tmp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 哨兵sentinel监控redis主节点的 ip port</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master-name 可以自己命名的主节点名字 只能有A-z 数字0-9 .-_ 组成</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> quorum 配置多少个sentinel哨兵统一认为master主节点实例，那面这时客观<span class="comment">#上认为主节点失联了</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt;  &lt;quorum&gt;</span></span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当在redis实例中开启了 requirepass foobared 授权密码 这样所有连接<span class="comment">#redis实例的客户端都要提供密码</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置哨兵sentinel连接主从密码  注意必须为主从设置一样的验证密码</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span><br><span class="line">sentinel auth-pass mymaster MySUPER--secret-0123passwOrd</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定多少毫秒后，主节点没有应答哨兵sentinel，哨兵主观上认为主节点下线 默认30秒</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行同步</span></span><br><span class="line"><span class="meta">#</span><span class="bash">这个数字越小，完成failover所需的时间就越长。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">但是如果这个数字越大，就意味着越多的slave因为replication而不可用</span></span><br><span class="line"><span class="meta">#</span><span class="bash">可以通过将这个值设为1来保证每次都有一个slave处于不能处理命令请求的状态。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel parallel-syncs  &lt;master-name&gt; &lt;numslaves&gt;</span></span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 故障转移超时时间failover-timeout可以用在以下这些方面</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1.同一个sentinel对同一个master两次failover之间的间隔时间</span></span><br><span class="line"><span class="meta">#</span><span class="bash">2.当一个slave从一个错误的master那同步数据开始计算时间，直到slave被纠正为向正确的master那里同步数据是</span></span><br><span class="line"><span class="meta">#</span><span class="bash">3.当想要取消一个正在进行的failover所需要的时间</span></span><br><span class="line"><span class="meta">#</span><span class="bash">4.当进行failover时，配置所有slaves指向新的master所需的最大时间，不过即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">默认三分钟</span></span><br><span class="line"><span class="meta">#</span><span class="bash">sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">SCRIPTS EXECUTION</span></span><br><span class="line"><span class="meta">#</span><span class="bash">配置当某一事件发生时所需要执行的脚步，可以通过脚步来通知管理员，例如当系统运行不正常是发邮件通知相关人员</span></span><br><span class="line"><span class="meta">#</span><span class="bash">对于脚步的运行结果由以下规则：</span></span><br><span class="line"><span class="meta">#</span><span class="bash">若脚步执行后返回1，那么该脚步稍后将会被再次执行，重复次数目前默认为10</span></span><br><span class="line"><span class="meta">#</span><span class="bash">若脚步执行后返回2，或者比2更高的一个返回值，脚步将不会重复执行</span></span><br><span class="line"><span class="meta">#</span><span class="bash">如果脚步在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">一个脚步的足底啊执行时间是60s,如果超过这个时间，脚步将会被一个sigkill信号终止，之后重新执行</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">通知型脚步：当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等），将会去调用这个脚步，这时这个脚步应该通过邮件，sms等方式去通知系统管理员关于系统不正常运行的信息，调用该脚本时，将传给脚步两个参数，一个是事件类型，一个是事件描述，如果sentinel.conf配置文件中配置了这个脚步路径，那么必须保证这个脚步存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功</span></span><br><span class="line"><span class="meta">#</span><span class="bash">通知脚步</span></span><br><span class="line"><span class="meta">#</span><span class="bash">sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">sentinel notification-script mymaster /var/redis/notify.sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">客户端重新配置主节点参数脚本</span></span><br><span class="line"><span class="meta">#</span><span class="bash">当一个master由于failover而发生改变时，这个脚步将会被调用，通知相关客户端关于master地址已经发生改变的信息，</span></span><br><span class="line"><span class="meta">#</span><span class="bash">以下参数将会在调用脚本时传递给脚本</span></span><br><span class="line"><span class="meta">#</span><span class="bash">&lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">目前&lt;state&gt;总是failover</span></span><br><span class="line"><span class="meta">#</span><span class="bash">&lt;role&gt;是leader或observer中第一个</span></span><br><span class="line"><span class="meta">#</span><span class="bash">参数from-ip from-port to-ip to-port是用来和旧的master和新的master（即旧的slave）通信的</span></span><br><span class="line"><span class="meta">#</span><span class="bash">这个脚步应该是通用的，能被多次调用，不是针对性的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>


                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Link</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://hellolinkai.github.io/2021/12/15/redis/">https://hellolinkai.github.io/2021/12/15/redis/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Link</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/redis/">
                                    <span class="chip bg-color">redis</span>
                                </a>
                            
                                <a href="/tags/nosql/">
                                    <span class="chip bg-color">nosql</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2021/12/15/redis/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="Redis">
                        
                        <span class="card-title">Redis</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-12-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/NoSql/" class="post-category">
                                    NoSql
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/redis/">
                        <span class="chip bg-color">redis</span>
                    </a>
                    
                    <a href="/tags/nosql/">
                        <span class="chip bg-color">nosql</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/12/14/hello-world/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="Hello World">
                        
                        <span class="card-title">Hello World</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-12-14
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            linkai
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <a href="/about" target="_blank">linkai</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/hellolinkai" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:link2810@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=531152920" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 531152920" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
